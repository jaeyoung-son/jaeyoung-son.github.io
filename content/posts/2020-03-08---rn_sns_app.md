---
title: '리액트 네이티브 sns앱 만들기'
date: '2020-03-05T12:10:32.169Z'
template: 'post'
draft: false
slug: '/posts/rn_sns_app/'
category: 'react_native'
description: '리액트 네이티브 sns  만들기'
tags:
  - 'react-native'
---

## 네비게이션 컴포넌트

```tsx
import React from 'react';
// .... ~

const LoginNavigator = createStackNavigator({
  Login,
  Signup,
  PasswordReset,
});

const MyFeedTab = createStackNavigator({
  MyFeed,
});

const FeedsTab = createStackNavigator({
  Feeds,
  FeedListOnly,
});

const UploadTab = createStackNavigator({
  Upload,
});

const ProfileTab = createStackNavigator({
  Profile,
});

const MainTabs = createBottomTabNavigator({
  MyFeed: {
    screen: MyFeedTab,
    navigationOptions: {
      tabBarIcon: ({focused}: {focused: boolean}) => (
        <Image
          source={
            focused
              ? require('~/Assets/Images/Tabs/ic_home.png')
              : require('~/Assets/Images/Tabs/ic_home_outline.png')
          }
        />
      ),
      tabBarOptions: {
        showLabel: false,
      },
    },
  },
  //  ... ~
    },
  },
});

const MainNavigator = createDrawerNavigator(
  {
    MainTabs,
  },
  {
    drawerPosition: 'right',
    drawerType: 'slide',
    contentComponent: Drawer,
  },
);

const AppNavigator = createSwitchNavigator(
  {
    CheckLogin,
    LoginNavigator,
    MainNavigator,
  },
  {
    initialRouteName: 'CheckLogin',
  },
);

export default createAppContainer(AppNavigator);

```

이번 앱에서는 스위치, 스택네비게이션 이외에도 탭, 드로워 네비게이션을 활용한다. 탭 네비게이션에 아이콘을 표시하기 위해 리액트 네이티비의 Image컴포넌트를 활용한다.  
화면에 표시될 컴포넌트 중 네비게이션 헤더가 필요한 컴포넌트는 기본적으로 스텍네비게이션을 추가해 주어야 한다.  
MainTabs에서 탭의 라벨을 제거하기 위해 tabBarOptions의 showLabel을 false로 설정 하였으며, 탭이 선택되었는지 여부에 따라 다른 이미지를 표시하도록 설정하였다.  
드로워 네비게이션은 주로 메뉴에서 많이 사용되는 네비게이션이다. droawerPosition 설정에 따라 위치를 정하고, 메뉴는 화면 위가 아닌 화면 전체를 이동시키면서 표시하기 위해 drawerType 을 slide로 설정했따.

## App 컴포넌트

```tsx
import React from 'react';
import { StatusBar } from 'react-native';
import Navigatoor from '~/Screen/Navigator';
import { RandomUserDataProvider } from '~/Context/RandomUserData';

interface Props {}

const App = ({}: Props) => {
  return (
    <RandomUserDataProvider cache={true}>
      <StatusBar barStyle="default" />
      <Navigatoor />
    </RandomUserDataProvider>
  );
};

export default App;
```

상태바의 색을 조정하기 위해 StatusBar를 사용하였다. 네비게이터도 표시되도록 설정하고, 앱 내에서 전역적으로 사용할 데이터를 사용하기 위해 RandomUserData 컨텍스트를 만들고 적용할 예정이다.

## 컨텍스트

```tsx
interface Props {
  cache?: boolean;
  children: JSX.Element | Array<JSX.Element>;
}

interface IRandomUserData {
  getMyFeed: (number?: number) => Array<IFeed>;
}

const RandomUserDataContext = createContext<IRandomUserData>({
  getMyFeed: (number: number = 10) => {
    return [];
  }
});

const RandomUserDataProvider = ({ cache, children }: Props) => {
  const [userList, setUserList] = useState<Array<IUserProfile>>([]);
  const [descriptionList, setDescriptionList] = useState<Array<string>>([]);
  const [imageList, setImageList] = useState<Array<string>>([]);

  const getCacheData = async (key: string) => {
    const cacheData = await AsyncStorage.getItem(key);
    if (cache === false || cacheData === null) {
      return undefined;
    }
    const cacheList = JSON.parse(cacheData);

    if (cacheList.length !== 25) {
      return undefined;
    }

    return cacheList;
  };
  const setCachedData = (key: string, data: Array<any>) => {
    AsyncStorage.setItem(key, JSON.stringify(data));
  };

  const setUsers = async () => {
    const cachedData = await getCacheData('UserList');
    if (cachedData) {
      setUserList(cachedData);
      return;
    }

    try {
      console.log('dasdasdasdasdasdasd');
      const response = await fetch('https://uinames.com/api/?amount=25&ext');
      const data = await response.json();
      setUserList(data);
      setCachedData('UserList', data);
    } catch (err) {
      console.log(err);
    }
  };

  const setDescriptions = async () => {
    const cachedData = await getCacheData('DescriptionList');

    if (cachedData) {
      setDescriptionList(cachedData);
      return;
    }

    try {
      const response = await fetch(
        'https://opinionated-quotes-api.gigalixirapp.com/v1/quotes?rand=t&n=25'
      );
      const data = await response.json();
      let text = [];
      for (const index in data.quotes) {
        text.push(data.quotes[index].quote);
      }
      setDescriptionList(text);
      setCachedData('DescriptionList', text);
    } catch (err) {
      console.log(err);
    }
  };

  const setImages = async () => {
    const cachedData = await getCacheData('ImageList');
    console.log(cachedData, '캐시데이타');
    if (cachedData) {
      console.log(cachedData, '캐시데이타');
      if (Image.queryCache) {
        Image.queryCache(cachedData);
        cachedData.map((data: string) => {
          Image.prefetch(data);
        });
      }
      setImageList(cachedData);
      return;
    }

    setTimeout(async () => {
      try {
        const response = await fetch('https://source.unsplash.com/random/');
        const data = response.url;
        if (imageList.indexOf(data) >= 0) {
          setImages();
          return;
        }
        setImageList([...imageList, data]);
      } catch (err) {
        console.log(err);
      }
    }, 400);
  };
  useEffect(() => {
    setUsers();
    setDescriptions();
  }, []);

  useEffect(() => {
    if (imageList.length !== 25) {
      setImages();
    } else {
      setCachedData('ImageList', imageList);
    }
  }, [imageList]);

  const getImages = (): Array<string> => {
    let images: Array<string> = [];
    const count = Math.floor(Math.random() * 4);

    for (let i = 0; i <= count; i++) {
      images.push(imageList[Math.floor(Math.random() * 24)]);
    }

    return images;
  };

  // ...~
};

export { RandomUserDataProvider, RandomUserDataContext };
```

전역 데이터는 화면에 표시될 이미지, 사용자 정보 등을 API를 통해 가져오고 랜덤으로 표시되도록 설정한다. 또한 API가 분당 호출 제한이 있어서, 가져온 데이터를 캐시하도록 만든다.

## 로그인 컴포넌트

```tsx
import React from 'react';
import AsyncStorage from '@react-native-community/async-storage';
import { NavigationScreenProp, NavigationState } from 'react-navigation';
import styled from 'styled-components/native';

import Input from '~/Components/Input';
import Button from '~/Components/Button';

interface Props {
  navigation: NavigationScreenProp<NavigationState>;
}

const Login = ({ navigation }: Props) => {
  return (
    <Container>
      <FormContainer>
        <Logo>SNS App</Logo>
        <Input style={{ marginBotton: 16 }} placeholder="이메일" />
        <Input
          style={{ marginBotton: 16 }}
          placeholder="비밀번호"
          secureTextEntry={true}
        />
        <PasswordReset onPress={() => navigation.navigate('PasswordReset')}>
          비밀번호 재설정
        </PasswordReset>
        <Button
          label="로그인"
          style={{ marginBotton: 24 }}
          onPress={() => {
            AsyncStorage.setItem('key', 'JWT_KEY');
            navigation.navigate('MainNavigator');
          }}
        />
        <SignupText>
          계정이 없는가요?{''}
          <SignupLink onPress={() => navigation.navigate('Signup')}>
            가입하기.
          </SignupLink>
        </SignupText>
      </FormContainer>
      <Footer>
        <Copyright>SNSApp from dev-jaeyoung</Copyright>
      </Footer>
    </Container>
  );
};

Login.navigationOptions = {
  header: null
};

export default Login;
```

로그인 컴포넌트는 크게 정보를 입력하는 폼과 하단에 푸터로 나뉜다. 로그인 화면에서 다른 여려화면으로 전환 가능하도록 구성하였다.
